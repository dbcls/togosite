{"version":3,"file":"report.js","sources":["../../source/js/classes/Records.js","../../source/js/classes/ReportApp.js","../../source/js/report.js"],"sourcesContent":["\nclass Records {\n\n  #subjects;\n  #properties;\n\n  constructor() {\n  }\n\n  // public methods\n\n  setSubjects(subjects) {\n    // define subjects\n    for (let i = 0; i < subjects.length; i++) {\n      let hue = 360 - (360 * i / subjects.length) + 180;\n      hue -= hue > 360 ? 360 : 0;\n      subjects[i].hue = hue;\n    }\n    this.#subjects = Object.freeze(subjects);\n    // set properties\n    this.#properties = [];\n    subjects.forEach(subject => {\n      subject.properties.forEach(property => {\n        this.#properties.push(Object.assign({subjectId: subject.subjectId}, property));\n      });\n    });\n    console.log(this.#subjects);\n    console.log(this.#properties);\n  }\n\n  setValues(propertyId, values) {\n    const property = this.#properties.find(property => property.propertyId === propertyId);\n    property.values = values;\n  }\n\n  getProperty(propertyId) {\n    console.log(propertyId)\n    const property = this.#properties.find(property => property.propertyId === propertyId);\n    console.log(property)\n    return property;\n  }\n\n  getValue(propertyId, categoryId) {\n    // const property = this.#properties.find(property => property.propertyId === propertyId);\n    const property = this.getProperty(propertyId);\n    const value = property.values.find(value => value.categoryId === categoryId);\n    return value;\n  }\n\n  // public accessors\n\n  get subjects() {\n    return this.#subjects;\n  }\n\n  get properties() {\n    return this.#properties;\n  }\n\n}\n\nexport default new Records();\n","import Records from './Records.js';\n\nconst CONF_PROPERTIES = 'https://raw.githubusercontent.com/dbcls/togosite/develop/config/togosite-human/properties.json';\nconst CONF_TEMPLATES = 'https://raw.githubusercontent.com/dbcls/togosite/develop/config/togosite-human/templates.json';\n\nclass ReportApp {\n\n  #templates;\n\n  constructor() {\n  }\n\n  ready() {\n\n    let stanzaTtemplates;\n    // load config json\n    Promise.all([\n      fetch(CONF_PROPERTIES),\n      fetch(CONF_TEMPLATES)\n    ])\n      .then(responces => Promise.all(responces.map(responce => responce.json())))\n      .then(([subjects, templates]) => {\n        stanzaTtemplates = templates;\n        Records.setSubjects(subjects);\n\n        // set stanza scripts\n        document.querySelector('head').insertAdjacentHTML('beforeend', templates.stanzas.map(stanza => `<script type=\"module\" src=\"${stanza}\"></script>`).join(''));\n\n        // get stanza templates\n        return Promise.all(\n          Object.keys(templates.templates).map(key => fetch(templates.templates[key]))\n        );\n      })\n      .then(responces => Promise.all(responces.map(responce => responce.text())))\n      .then(templates => {\n        this.#templates = Object.fromEntries(Object.keys(stanzaTtemplates.templates).map((stanza, index) => [stanza, templates[index]]));\n\n        this.#drawStanzas();\n      });\n  }\n\n  #drawStanzas() {\n    const urlVars = Object.fromEntries(window.location.search.substr(1).split('&').map(keyValue => keyValue.split('=')));\n    const properties = JSON.parse(decodeURIComponent(urlVars.properties));\n    \n    const main = document.querySelector('main');\n    const subjectId = Records.subjects.find(subject => subject.togoKey === urlVars.togoKey).subjectId;\n    main.innerHTML =\n      this.#stanza(subjectId, urlVars.id, urlVars.togoKey) +\n      properties.map(property => {\n        if (property === undefined) {\n          return '';\n        } else {\n          const subject = Records.subjects.find(subject => subject.properties.some(subjectProperty => subjectProperty.propertyId === property.propertyId));\n          const property2 = subject.properties.find(property => property.propertyId === property.propertyId);\n          return `<hr>\n          <div class=\"attributes\">\n            <header style=\"background-color: ${this.getHslColor(subject.hue)};\">${property2.label}</header>\n            ${property.attributes.map(attribute => this.#stanza(subject.subjectId, attribute.id, property.propertyKey)).join('')}\n          </div>`;\n        }\n      }).join('');\n  }\n\n  #stanza(subjectId, id, key) {\n    return `<div class=\"stanza\">${this.#templates[subjectId].replace(/{{id}}/g, id).replace(/{{type}}/g, key)}</div>`;\n  }\n\n  // utilities\n  getHslColor(hue) {\n    return `hsl(${hue}, 50%, 55%)`;\n  }\n\n}\n\nexport default new ReportApp();\n","import ReportApp from './classes/ReportApp.js';\n\nglobalThis.togositeapp = ReportApp;\nReportApp.ready();\n"],"names":["Records","subjects","i","length","hue","Object","freeze","forEach","subject","properties","property","push","assign","subjectId","console","log","propertyId","values","find","categoryId","getProperty","value","CONF_PROPERTIES","CONF_TEMPLATES","ReportApp","stanzaTtemplates","Promise","all","fetch","then","responces","map","responce","json","templates","setSubjects","document","querySelector","insertAdjacentHTML","stanzas","stanza","join","keys","key","text","fromEntries","index","urlVars","window","location","search","substr","split","keyValue","JSON","parse","decodeURIComponent","main","togoKey","innerHTML","id","undefined","some","subjectProperty","property2","getHslColor","label","attributes","attribute","propertyKey","replace","globalThis","togositeapp","ready"],"mappings":"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"}